# ğŸ¥ Happy Health Clinic - Backend API

> **Final Backend Development Project**  
> Complete clinic management system with RESTful APIs, JWT authentication, and external integrations.

---

## ğŸ“‹ Table of Contents

- [Description](#-description)
- [Technologies](#-technologies)
- [Architecture](#-architecture)
- [Project Setup](#-project-setup)
- [Configuration](#-configuration)
- [Running the Application](#-running-the-application)
- [API Documentation](#-api-documentation)
- [Postman Collection](#-postman-collection)
- [Database](#-database)
- [Security](#-security)
- [External APIs](#-external-apis)
- [Testing](#-testing)
- [Project Structure](#-project-structure)

---

## ğŸ“– Description

**Happy Health Clinic** is a comprehensive clinic management system that includes:

- ğŸ‘¥ **User Management**: Patients, Doctors, Administrative Staff
- ğŸ“… **Appointment System** with integrated weather forecasts (OpenWeather API)
- ğŸ“‹ **Medical Records** with diagnoses and ICD-10 codes
- ğŸ’Š **Medical Prescriptions** with pharmaceutical information (FDA Drug API)
- ğŸ’° **Billing & Invoicing** with automatic email notifications (Mailgun API)
- ğŸ” **JWT Authentication** and role-based authorization

---

## ğŸ›  Technologies

### Backend
- **Java 21**
- **Spring Boot 4.0.1**
- **Spring Security** (JWT Authentication)
- **Spring Data JPA**
- **PostgreSQL** (Database)
- **Maven** (Build Tool)

### External APIs
- **OpenWeather API** - Weather forecasts for appointments
- **FDA Drug API** - Pharmaceutical information for prescriptions
- **Mailgun API** - Email delivery for invoices
- **UI Avatars API** - User avatars

### Tools
- **Lombok** - Boilerplate reduction
- **Jakarta Validation** - Data validation
- **Postman** - API Testing (57 requests)

---

## ğŸ— Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚ (Postman)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Spring Boot Application          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Security Layer (JWT)         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Controllers (REST)           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Services (Business Logic)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Repositories (Data Access)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   PostgreSQL   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   External APIs      â”‚
     â”‚ - OpenWeather        â”‚
     â”‚ - FDA Drug           â”‚
     â”‚ - Mailgun            â”‚
     â”‚ - UI Avatars         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Architectural Patterns
- **Layered Architecture** (Controller â†’ Service â†’ Repository)
- **DTO Pattern** (Request/Response separation)
- **Repository Pattern** (Data access abstraction)
- **Dependency Injection** (Spring IoC)

---

## ğŸš€ Project Setup

### Prerequisites
```bash
# Java 21+
java -version

# PostgreSQL 14+
psql --version

# Maven 3.8+ (or use ./mvnw wrapper)
mvn -version
```

### 1. Clone Repository
```bash
git clone <repository-url>
cd happy-health-clinic
```

### 2. Database Setup
```sql
-- Connect to PostgreSQL
psql -U postgres

-- Create database
CREATE DATABASE happy_health_clinic;

-- Create user (optional)
CREATE USER clinic_admin WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE happy_health_clinic TO clinic_admin;
```

### 3. Configuration
```bash
# Copy configuration template
cp src/main/resources/application-local.properties.template src/main/resources/application-local.properties

# Edit with your values
nano src/main/resources/application-local.properties
```

---

## âš™ï¸ Configuration

### File: `application-local.properties`
```properties
# ===================================
# DATABASE CONFIGURATION
# ===================================
spring.datasource.url=jdbc:postgresql://localhost:5432/happy_health_clinic
spring.datasource.username=YOUR_DB_USERNAME
spring.datasource.password=YOUR_DB_PASSWORD

spring.jpa.hibernate.ddl-auto=create
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# ===================================
# SERVER CONFIGURATION
# ===================================
server.port=3001

# ===================================
# JWT CONFIGURATION
# ===================================
jwt.secret=YOUR_SECRET_KEY_HERE_MUST_BE_AT_LEAST_256_BITS_LONG
jwt.expiration=86400000

# ===================================
# EXTERNAL APIs (Optional - not required for basic functionality)
# ===================================

# OpenWeather API (for weather forecasts in appointments)
openweather.api.key=YOUR_OPENWEATHER_API_KEY
openweather.api.url=https://api.openweathermap.org/data/2.5/forecast

# FDA Drug API (for drug information in prescriptions)
fda.api.url=https://api.fda.gov/drug/label.json

# Mailgun API (for sending invoice emails)
mailgun.api.key=YOUR_MAILGUN_API_KEY
mailgun.domain=YOUR_MAILGUN_DOMAIN
mailgun.from.email=noreply@YOUR_DOMAIN.com
mailgun.from.name=Happy Health Clinic
```

### Obtaining API Keys (Optional)

| API | Registration | Free Tier |
|-----|--------------|-----------|
| **OpenWeather** | https://openweathermap.org/api | âœ… 1000 calls/day |
| **FDA Drug** | https://open.fda.gov | âœ… Unlimited (no key needed) |
| **Mailgun** | https://www.mailgun.com | âœ… 5000 emails/month |

**âš ï¸ Note:** External APIs are **optional**. The application works without them (related features will be disabled).

---

## â–¶ï¸ Running the Application

### Option 1: Maven Wrapper (Recommended)
```bash
# Linux/Mac
./mvnw spring-boot:run

# Windows
mvnw.cmd spring-boot:run
```

### Option 2: Installed Maven
```bash
mvn spring-boot:run
```

### Option 3: JAR File
```bash
# Build
./mvnw clean package

# Run
java -jar target/happy-health-clinic-0.0.1-SNAPSHOT.jar
```

### Verify Startup
```bash
# Application should be available at:
http://localhost:3001

# Test public endpoint:
curl http://localhost:3001/actuator/health
```

---

## ğŸ“š API Documentation

### Base URL
```
http://localhost:3001
```

### Authentication

All APIs (except `/auth/*` and `/setup/*`) require JWT authentication.

**Required header:**
```
Authorization: Bearer <JWT_TOKEN>
```

### Main Endpoints

#### ğŸ” Authentication
```http
POST   /auth/login           # User login
POST   /auth/register        # New patient registration
```

#### ğŸ‘¨â€âš•ï¸ Doctors
```http
GET    /doctors              # List doctors (paginated)
GET    /doctors/{id}         # Doctor details
GET    /doctors/specialization/{specialization}  # Search by specialization
POST   /doctors              # Create doctor (ADMIN)
PUT    /doctors/{id}         # Update doctor (ADMIN)
DELETE /doctors/{id}         # Delete doctor (ADMIN)
```

#### ğŸ‘” Staff
```http
GET    /staff                # List staff (paginated)
GET    /staff/{id}           # Staff details
GET    /staff/role/{role}    # Search by role
POST   /staff                # Create staff (ADMIN)
PUT    /staff/{id}           # Update staff (ADMIN)
DELETE /staff/{id}           # Delete staff (ADMIN)
```

#### ğŸ‘¥ Patients
```http
GET    /patients             # List patients (paginated)
GET    /patients/{id}        # Patient details
GET    /patients/code/{code} # Search by patient code
PUT    /patients/{id}        # Update patient (ADMIN)
DELETE /patients/{id}        # Delete patient (ADMIN)
```

#### ğŸ“… Appointments (+ OpenWeather API)
```http
GET    /appointments                    # List appointments (paginated)
GET    /appointments/{id}               # Appointment details
GET    /appointments/patient/{patientId}  # Patient appointments
GET    /appointments/doctor/{doctorId}    # Doctor appointments
GET    /appointments/status/{status}      # Search by status
GET    /appointments/date-range           # Search by date range
POST   /appointments                      # Create appointment (with weather)
PUT    /appointments/{id}                 # Update appointment
DELETE /appointments/{id}                 # Delete appointment (ADMIN)
```

#### ğŸ“‹ Medical Records
```http
GET    /medical-records                 # List records (paginated)
GET    /medical-records/{id}            # Record details
GET    /medical-records/patient/{patientId}  # Patient records
GET    /medical-records/doctor/{doctorId}    # Doctor records
GET    /medical-records/date-range           # Search by date range
POST   /medical-records                      # Create record (DOCTOR)
PUT    /medical-records/{id}                 # Update record (DOCTOR)
DELETE /medical-records/{id}                 # Delete record (ADMIN)
```

#### ğŸ’Š Prescriptions (+ FDA Drug API)
```http
GET    /prescriptions                          # List prescriptions (paginated)
GET    /prescriptions/{id}                     # Prescription details
GET    /prescriptions/medical-record/{recordId}  # By medical record
GET    /prescriptions/patient/{patientId}        # By patient
GET    /prescriptions/patient/{patientId}/active # Active prescriptions
GET    /prescriptions/search?drugName={name}     # Search by drug name
POST   /prescriptions                            # Create prescription (with FDA)
PUT    /prescriptions/{id}                       # Update prescription
DELETE /prescriptions/{id}                       # Delete prescription (ADMIN)
```

#### ğŸ’° Invoices (+ Mailgun Email)
```http
GET    /invoices                       # List invoices (paginated)
GET    /invoices/{id}                  # Invoice details
GET    /invoices/number/{number}       # Search by invoice number
GET    /invoices/patient/{patientId}   # Patient invoices
GET    /invoices/status/{status}       # Search by status
GET    /invoices/overdue               # Overdue invoices
GET    /invoices/total/{status}        # Total by status
POST   /invoices                       # Create invoice (with email)
PUT    /invoices/{id}                  # Update invoice (ADMIN)
PATCH  /invoices/{id}/pay              # Mark as paid
DELETE /invoices/{id}                  # Delete invoice (ADMIN)
```

---

## ğŸ“¬ Postman Collection

### Import Collection

1. Open Postman
2. Click **Import**
3. Select file: `happy_health_clinic.postman_collection.json`
4. Import

### Variable Configuration

The collection includes pre-configured variables:
```javascript
baseUrl = http://localhost:3001
token = (auto-populated after login)
patientId = (auto-populated)
doctorId = (auto-populated)
// ... other auto-managed variables
```

### Recommended Workflow
```
1. Setup â†’ Create Admin User
2. Authentication â†’ Login (saves token)
3. Authentication â†’ Register Random Patient (3-5 times)
4. Doctors â†’ Create Random Doctor (2-3 times)
5. Staff â†’ Create Random Staff (1-2 times)
6. Appointments â†’ Create Appointment
7. Appointments â†’ Mark as COMPLETED
8. Medical Records â†’ Create Medical Record
9. Prescriptions â†’ Create Prescription
10. Invoices â†’ Create Invoice
```

### Collection Features

- âœ… **57 Complete Requests**
- âœ… **Randomized Data** for realistic testing
- âœ… **Auto-save IDs** between requests
- âœ… **Pre/Post-request Scripts** for automation
- âœ… **Detailed Console Logging**
- âœ… **Automatic Test Assertions**

---

## Database

### ER Schema

Below is the Entityâ€“Relationship (ER) schema of the database, which provides a clear overview of the core entities and their relationships within the system.

![ER Schema](./er-schema.png)

The schema can also be viewed and explored interactively on drawSQL at the following link:  
[View ER Schema on drawSQL](https://drawsql.app/teams/epicode-university/diagrams/happy-health-clinic-system)


### Main Tables

| Table | Description | Relations |
|-------|-------------|-----------|
| `users` | Base users (Single Table Inheritance) | - |
| `patients` | Patients | â†’ users |
| `employees` | Employees | â†’ users |
| `doctors` | Doctors | â†’ employees |
| `staff` | Administrative staff | â†’ employees |
| `appointments` | Appointments | â†’ patients, doctors |
| `medical_records` | Medical records | â†’ patients, doctors, appointments |
| `prescriptions` | Prescriptions | â†’ medical_records, patients |
| `invoices` | Invoices | â†’ patients, appointments |

### Initialization
```sql
-- Tables are automatically created by Hibernate
-- with spring.jpa.hibernate.ddl-auto=create

-- Admin is created via endpoint /setup/create-admin
-- All other data via Postman Collection
```

---

## ğŸ”’ Security

### JWT Authentication
```
1. User â†’ POST /auth/login
2. Server â†’ Validates credentials
3. Server â†’ Generates JWT token
4. Client â†’ Saves token
5. Client â†’ Sends token in header: Authorization: Bearer <token>
6. Server â†’ Validates token for each request
```

### Roles and Permissions

| Role | Access |
|------|--------|
| **ADMIN** | Full access to all resources |
| **DOCTOR** | Manage appointments, medical records, prescriptions |
| **PATIENT** | View own information, book appointments |
| **STAFF** | Manage appointments, view patients |

### Public Endpoints
```
/auth/login
/auth/register
/setup/create-admin (only if admin doesn't exist)
```

### Password Security

- Hashing with **BCrypt**
- Min 8 characters
- At least 1 uppercase letter
- At least 1 lowercase letter
- At least 1 number
- At least 1 special character

---

## ğŸŒ External APIs

### 1. OpenWeather API (Appointments)

**Functionality:**
- Weather forecast for appointment date
- Severe weather alerts
- Temperature and conditions

**Configuration:**
```properties
openweather.api.key=YOUR_KEY
```

**Behavior:**
- âœ… API available â†’ Weather data included in response
- âŒ API unavailable â†’ Appointment created without weather

---

### 2. FDA Drug API (Prescriptions)

**Functionality:**
- Drug information
- Side effects
- Contraindications

**Configuration:**
```properties
fda.api.url=https://api.fda.gov/drug/label.json
# No API key required
```

**Behavior:**
- âœ… Drug found â†’ FDA data included
- âŒ Drug not found â†’ Prescription created without FDA data

---

### 3. Mailgun API (Invoices)

**Functionality:**
- Send invoice email to patient
- Professional HTML template
- Delivery tracking

**Configuration:**
```properties
mailgun.api.key=YOUR_KEY
mailgun.domain=YOUR_DOMAIN
mailgun.from.email=noreply@{mailgun.domain}
```

**Behavior:**
- âœ… Email sent â†’ Success logged
- âŒ Send error â†’ Invoice created, error logged

---

### 4. UI Avatars (User Profiles)

**Functionality:**
- Automatic avatars for users
- Based on name/initials
- Colors by role

**Example:**
```
https://ui-avatars.com/api/?name=John+Doe&background=0D8ABC&color=fff
```

**Behavior:**
- Always available (public service)
- No configuration required

---

## ğŸ§ª Testing

### Manual Testing (Postman)
```bash
# 1. Import collection
# 2. Execute in order:

Folder 0: Setup (1 request)
Folder 1: Authentication (2 requests)
Folder 2: Doctors (6 requests)
Folder 3: Staff (6 requests)
Folder 4: Patients (5 requests)
Folder 5: Appointments (9 requests)
Folder 6: Medical Records (8 requests)
Folder 7: Prescriptions (9 requests)
Folder 8: Invoices (11 requests)

Total: 57 requests
```

### Test Scenarios

#### Scenario 1: Registration and Login
```
1. Create Admin
2. Login as Admin
3. Register Patient
4. Login as Patient
```

#### Scenario 2: Appointment Booking
```
1. Login as Patient
2. Get All Doctors
3. Create Appointment
4. Get Appointment (verify weather)
```

#### Scenario 3: Complete Visit
```
1. Create Appointment (DOCTOR/ADMIN)
2. Mark as COMPLETED
3. Create Medical Record (DOCTOR)
4. Create Prescription (DOCTOR)
5. Create Invoice (ADMIN)
6. Verify Email Sent
```

---

## ğŸ“ Project Structure
```
happy-health-clinic/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/it/fpili/happy_health_clinic/
â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/     # REST Controllers
â”‚   â”‚   â”‚   â”œâ”€â”€ dto/             # Data Transfer Objects
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ request/     # Request DTOs
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ response/    # Response DTOs
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/        # JPA Entities
â”‚   â”‚   â”‚   â”œâ”€â”€ enums/           # Enumerations
â”‚   â”‚   â”‚   â”œâ”€â”€ exceptions/      # Custom Exceptions
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/    # Spring Data Repositories
â”‚   â”‚   â”‚   â”œâ”€â”€ security/        # JWT Filter & Utils
â”‚   â”‚   â”‚   â”œâ”€â”€ services/        # Business Logic
â”‚   â”‚   â”‚   â””â”€â”€ HappyHealthClinicApplication.java
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.properties
â”‚   â”‚       â””â”€â”€ application-local.properties.template
â”‚   â””â”€â”€ test/                    
â”œâ”€â”€ pom.xml
â”œâ”€â”€ happy_health_clinic.postman_collection.json
â””â”€â”€ README.md
```

---

## ğŸ¯ Implemented Features

### Core Features
- âœ… Multi-role user management (Admin, Doctor, Staff, Patient)
- âœ… JWT Authentication
- âœ… Role-based authorization
- âœ… Complete CRUD for all entities
- âœ… Data validation (Jakarta Validation)
- âœ… Centralized exception handling
- âœ… Pagination and sorting
- âœ… Search and filters

### External Integrations
- âœ… OpenWeather API (weather forecasts)
- âœ… FDA Drug API (drug information)
- âœ… Mailgun API (email notifications)
- âœ… UI Avatars API (user avatars)

### Advanced Features
- âœ… Single Table Inheritance (User â†’ Patient/Employee)
- âœ… Joined Table Inheritance (Employee â†’ Doctor/Staff)
- âœ… Cascade operations
- âœ… Soft deletes (via status)
- âœ… Auto-generated codes (Patient, Invoice)
- âœ… Business logic validation
- âœ… Date range queries
- âœ… Financial calculations

---

## ğŸ“ Development Notes

### Code Conventions
- **Naming**: CamelCase for classes, camelCase for variables
- **Package structure**: By layer (controllers, services, repositories)
- **DTOs**: Separated into request/response
- **Lombok**: Used to reduce boilerplate

### Best Practices
- Repository Pattern for data access
- Service layer for business logic
- DTO Pattern for API contracts
- Exception handling with @RestControllerAdvice
- Validation with Bean Validation
- Security with Spring Security + JWT

---

## ğŸ‘¨â€ğŸ’» Author

**Filippo Pili**

**Project**: Happy Health Clinic

**Academic Year**: 2025/2026

---

## ğŸ“„ License

This project was developed for educational purposes.

---

## ğŸ†˜ Troubleshooting

### Issue: Database connection error
```bash
# Verify PostgreSQL is running
sudo systemctl status postgresql

# Verify credentials in application-local.properties
```

### Issue: Invalid JWT Token
```bash
# Verify jwt.secret in application-local.properties
# Must be at least 256 bits (32+ characters)
```

### Issue: External APIs not working
```bash
# External APIs are optional
# Verify API keys in application-local.properties
# App works without them
```

### Issue: Port 3001 already in use
```bash
# Change port in application-local.properties
server.port=8080

# Also update baseUrl in Postman Collection
```

---

**ğŸ‰ Happy Testing!**